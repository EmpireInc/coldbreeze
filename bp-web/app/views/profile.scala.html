@import service.DemoUser
@import controllers.employeeParams
@import controllers.managerParams
@import controllers.planInfo
@import models.DAO.resources.ActPermission
@import models.DAO.resources.BusinessServiceDTO
@import models.DAO.resources.BusinessDTO
@import controllers.BusinessServiceForms._

@(user: DemoUser, mngParams: Option[managerParams], empParams: Option[employeeParams], plan: Option[planInfo], walkthrought: Boolean )(currentPage: Page[BusinessServiceDTO], currentOrderBy: Int, currentFilter: String, businesses: List[BusinessDTO])(implicit request: RequestHeader, env: securesocial.core.RuntimeEnvironment[service.DemoUser])

@import securesocial.core.IdentityProvider

@import securesocial.core.IdentityProvider
@import securesocial.core.providers.UsernamePasswordProvider
@import securesocial.core.AuthenticationMethod._
@import play.api.{Logger, Play}
@import helper._
@import play.api.Play
@import models.DAO.resources.BusinessServiceDTO
@import models.DAO.resources.BusinessDTO
@import helper._


@****************************************
* Helper generating navigation links *
****************************************@


@**********************************
* Helper generating table headers *
***********************************@
@header(orderBy: Int, title: String) = {
    <th class="col@orderBy header @if(scala.math.abs(currentOrderBy) == orderBy) @{if(currentOrderBy < 0) "headerSortDown" else "headerSortUp"}">
        <a href="#">@title</a>
    </th>
}
@biz(ser: BusinessServiceDTO) = {
  @{businesses.find(b => b.id == Some(ser.business_id)) match {
   case Some(business) => <b> @{business.title} </b>
   case _ => <b></b>
 }}
}
@elemOut(perm: ActPermission) = {
  @if(perm.space_elem_id.isDefined) {
     <b>@empParams.get.elems_titles(perm.space_elem_id.get)</b>
    <b>@empParams.get.bps.find(_.id == Some(perm.bprocess)).get.title</b>    

}
  @if(perm.front_elem_id.isDefined) {
  <b>@empParams.get.elems_titles(perm.front_elem_id.get)</b>
    <b>@empParams.get.bps.find(_.id == Some(perm.bprocess)).get.title</b>
}
}


@main(Messages("page.profile")(LangDet.getLang(user) ), user) {
<div class="teamApisListWrap"><div class="panelLike organisationsGridLike">

<div class="teamSettings">
<div class="grids">
  @if(walkthrought) {

  <div class="page-sessions">
    <h2>Sessions</h2>
      <ul class="sessions-menu">
         <li><a href="@routes.Application.app()#/bprocesses?service=@entity.id">Session 1</a></li>
         <li><a href="@routes.Application.app()#/bprocesses?service=@entity.id">Session 2</a></li>
         <li><a href="@routes.Application.app()#/bprocesses?service=@entity.id">Session 3</a></li>
         <li><a href="@routes.Application.app()#/bprocesses?service=@entity.id">Session 4</a></li>
      </ul>
    <!-- <span class="uicon-svg54"></span>    -->
  </div>


  
  }
  <div class="page-header">
      <h2><a href="https://gravatar.com" data-toggle="tooltip" title="" data-original-title="Change your avatar"><img src="@user.main.avatarUrl.getOrElse("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iRWJlbmVfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiIHhtbDpzcGFjZT0icHJlc2VydmUiPjx0aXRsZT5EZWZhdWx0IEF2YXRhcjwvdGl0bGU+PGRlc2M+RGVmYXVsdCBBdmF0YXIgZm9yIFdDRiAyLjA8L2Rlc2M+IDxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PCFbQ0RBVEFbLnN1cmZhY2UgeyBmaWxsOiAjZmZmOyB9LnNoYWRvdyB7IGZpbGw6ICNiYmI7IH1dXT48L3N0eWxlPjwvZGVmcz48cmVjdCB4PSIwIiBjbGFzcz0ic2hhZG93IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiLz48cGF0aCBjbGFzcz0ic3VyZmFjZSIgZD0iTTMuNTI4LDE2QzMuNzc2LDExLjQ5OSw1LjY4NCw4LDgsOHM0LjIyNCwzLjQ5OSw0LjQ3Myw3Ljk5OCIvPjxjaXJjbGUgY2xhc3M9InN1cmZhY2UiIGN4PSI4IiBjeT0iNiIgcj0iMy41Ii8+PC9zdmc+")" alt="@user.main.firstName.getOrElse("")" width="40px" height="40px"/></a> @Messages("profile.welcome")(LangDet.getLang(user) ) @user.main.firstName.getOrElse("")</h2>
@if(user.isManager) {

                  @Messages("page.yourPlan")(LangDet.getLang(user) ): @plan.get.title plan until <span class="date">@plan.get.expire_at</span>
                <a href="plans">@Messages("page.plans")(LangDet.getLang(user) )</a>
<script>
$('span.date').text(moment($('span.date').text()).format('MMMM Do YYYY, h:mm:ss a'))
</script>

}


  </div>

<div class="vertical-menu">
  <ul id="dashTab">
    <li>
      <a href="#dashboard" data-toggle="tab"> <span class="segment-label">Dashboard</span></a>
    </li>
    @if(user.isManager) {
    <li>
      <a href="#services" data-toggle="tab"><span class="segment-label">Services</span></a>
    </li>
    }
  </ul>
</div>


<div class="tab-content">

<div class="dashboard tab-pane" id="dashboard">
  <div class="activities">
    <div class="processes" style="
">
      <div class="proc widget widget-1x1">
  
  <div class="widget-overlay"><div class="widget-overlay-inner"><div class="ember-view progress progress-info"><div class="progress-bar" style="width: 98.99999999999979%" data-bindattr-11126="11126"></div>
</div><span class="widget-overlay-state">Validating Credentials</span></div></div><div class="widget-front" style="
">
  <h3 class="widget-title" style="border-bottom: 2px solid rgba(90,76,112, 1)" data-bindattr-11130="11130">
    <span class="state-sign pending" data-bindattr-11131="11131"></span>
    Process Name
    
  </h3>
  <div class="widget-inner">
    <header style="  
">
      <h2 class="widget-chart-title" style="
">0%</h2>
      <h4 class="widget-chart-subtitle" style="
"></h4>
    </header>
    <div class="widget-chart" data-highcharts-chart="3"></div>
    <div class="widget-values">
      <ul class="widget-values-list">
        
        <li>
          <span class="widget-values-list-title">0 Bytes</span>
          <strong class="widget-values-list-value" style="color: #46CBB4" data-bindattr-12831="12831">
            
          </strong>
        </li>
        
        <li>
          <span class="widget-values-list-title">No data</span>
          <strong class="widget-values-list-value" style="color: #FF5858" data-bindattr-12832="12832">
            
          </strong>
        </li>
        
      </ul>
    </div>
    <footer>
      <h4 class="widget-subtitle">Storage &amp; usage</h4>
    </footer>
  </div>

</div><div class="widget-back">
  <div class="widget-inner">
  </div>
</div></div>



      
    </div>
  </div>
  <div class="actions">
    <div class="avalToStart g1of2"><h2>You can start</h2></div>
    <div class="avalToResume g1of2"><h2>You can resume</h2></div>
  </div>
</div>


<div class="g5of6 manager-tab tab-pane" id="services">



  @if(user.isManager) {
  
  <div class="teamChangeBox teamPaddedBox">
  <!-- <h2 class="teamBoxHeading">@Messages("page.managerBoard")(LangDet.getLang(user) ) </h2> -->
    <div class="teamSettingsCheckbox">
    <h3 class="teamSettingsHeading">@Messages("page.services")(LangDet.getLang(user) )</h3>
    <p class="teamSettingsAbout">@Messages("page.servicesDesc")(LangDet.getLang(user) )</p>
    <div id="actions">
      <!--<a class="btn success" id="add" href="@routes.BusinessServiceController.create()">Add a service</a>-->
        @form(routes.BusinessServiceController.create_new()) {
        <fieldset>



        @inputText(serviceForm("title"), '_label -> Messages("page.name")(LangDet.getLang(user) ), 'class -> "form-control")
        </fieldset>

        <div class="actions">
        <input type="submit" value="Create service" class="btn btn-primary"> 
        </div>
        }
    </div>
    @Option(currentPage.items).filterNot(_.isEmpty).map { entities =>
        <table class="computers zebra-striped">
            <thead>
                <tr>
                    @header(1, Messages("page.service")(LangDet.getLang(user) ) )
                    @header(2, "")
                    @header(3, "")
                </tr>
            </thead>
            <tbody>
                @entities.map {
                 case (entity) => {
                        <tr>
                            <td>
<a href="@routes.Application.app()#/bprocesses?service=@entity.id">@entity.title</a></td>
                            <td>
                                <a href="@routes.BusinessServiceController.update(entity.id.get)">@Messages("page.rename")(LangDet.getLang(user) )</a>

                            </td>
                            <td>
                              @form(routes.BusinessServiceController.destroy(entity.id.get), 'class -> "topRight") {
                                  <input type="submit" value="Delete service" class="btn danger">
                              }
                            </td>
                        </tr>
                     }
                }
            </tbody>
        </table>
    }
  </div>
  </div>
  }






</div>

</div><!-- tabcontent -->



<script>
$(function () {
    $('#dashTab a:last').tab('show');
  })
</script>

    
@if(user.isEmployee) {
<div class="g3of4 employee-tab">
  <div class="teamChangeBox teamPaddedBox">
  <h2 class="teamBoxHeading">@Messages("page.employeeBoard")(LangDet.getLang(user) )</h2>
<div class="perms">
<h3>Permissions:</h3>
<table class="computers zebra-striped">
            <thead>
                <tr>
                    @header(1, Messages("page.actPermissions")(LangDet.getLang(user) ))
                    @header(2, "")
                    @header(3, "")
                </tr>
            </thead>
            <tbody>
                @empParams.get.perms.map{ case (entity) => {
                        <tr>
                            <td><a href="#a/bprocess/@entity.bprocess">@entity.id</a></td>
                           
                            <td>
                             @elemOut(entity)
                            </td>
                        </tr>
                     }
                }
            </tbody>
        </table>


</div>
<div class="acts">
<h3>Acts: </h3>
<table class="computers zebra-striped">
            <thead>
                <tr>
                    @header(1, Messages("page.process")(LangDet.getLang(user) ))
                    @header(2, Messages("page.element")(LangDet.getLang(user) ))
                </tr>
            </thead>
            <tbody>
                @empParams.get.res_acts.map{ entity =>
                        <tr>
                            <td><a href="#a/bprocess/@entity.bprocess_id">@entity.bprocess_title</a></td>
                            <td>
                         @entity.elem_title
                            </td>
                        </tr>
                     }
            </tbody>
        </table>

</div>


  </div>
</div>
}


</div>





   </div> 
</div>
</div>
</div>

}
