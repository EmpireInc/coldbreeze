@import service.DemoUser
@import controllers.employeeParams
@import controllers.managerParams
@import models.DAO.resources.ActPermission
@import models.DAO.resources.BusinessServiceDTO
@import models.DAO.resources.BusinessDTO
@import controllers.BusinessServiceForms._

@(user: DemoUser, mngParams: Option[managerParams], empParams: Option[employeeParams])(currentPage: Page[BusinessServiceDTO], currentOrderBy: Int, currentFilter: String, businesses: List[BusinessDTO])(implicit request: RequestHeader, env: securesocial.core.RuntimeEnvironment[service.DemoUser])

@import securesocial.core.IdentityProvider

@import securesocial.core.IdentityProvider
@import securesocial.core.providers.UsernamePasswordProvider
@import securesocial.core.AuthenticationMethod._
@import play.api.{Logger, Play}
@import helper._
@import play.api.Play
@import models.DAO.resources.BusinessServiceDTO
@import models.DAO.resources.BusinessDTO
@import helper._


@****************************************
* Helper generating navigation links *
****************************************@


@**********************************
* Helper generating table headers *
***********************************@
@header(orderBy: Int, title: String) = {
    <th class="col@orderBy header @if(scala.math.abs(currentOrderBy) == orderBy) @{if(currentOrderBy < 0) "headerSortDown" else "headerSortUp"}">
        <a href="#">@title</a>
    </th>
}
@biz(ser: BusinessServiceDTO) = {
  @{businesses.find(b => b.id == Some(ser.business_id)) match {
   case Some(business) => <b> @{business.title} </b>
   case _ => <b></b>
 }}
}
@elemOut(perm: ActPermission) = {
  @if(perm.space_elem_id.isDefined) {
     <b>@empParams.get.elems_titles(perm.space_elem_id.get)</b>
    <b>@empParams.get.bps.find(_.id == Some(perm.bprocess)).get.title</b>    

}
  @if(perm.front_elem_id.isDefined) {
  <b>@empParams.get.elems_titles(perm.front_elem_id.get)</b>
    <b>@empParams.get.bps.find(_.id == Some(perm.bprocess)).get.title</b>
}
}


@main("Profile", user) {
<div class="teamApisListWrap"><div class="panelLike organisationsGridLike">

<div class="teamSettings">
<div class="grids">
  <div class="page-header">
      <h2><img src="@user.main.avatarUrl.getOrElse("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iRWJlbmVfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiIHhtbDpzcGFjZT0icHJlc2VydmUiPjx0aXRsZT5EZWZhdWx0IEF2YXRhcjwvdGl0bGU+PGRlc2M+RGVmYXVsdCBBdmF0YXIgZm9yIFdDRiAyLjA8L2Rlc2M+IDxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PCFbQ0RBVEFbLnN1cmZhY2UgeyBmaWxsOiAjZmZmOyB9LnNoYWRvdyB7IGZpbGw6ICNiYmI7IH1dXT48L3N0eWxlPjwvZGVmcz48cmVjdCB4PSIwIiBjbGFzcz0ic2hhZG93IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiLz48cGF0aCBjbGFzcz0ic3VyZmFjZSIgZD0iTTMuNTI4LDE2QzMuNzc2LDExLjQ5OSw1LjY4NCw4LDgsOHM0LjIyNCwzLjQ5OSw0LjQ3Myw3Ljk5OCIvPjxjaXJjbGUgY2xhc3M9InN1cmZhY2UiIGN4PSI4IiBjeT0iNiIgcj0iMy41Ii8+PC9zdmc+")" alt="@user.main.firstName.getOrElse("")" width="40px" height="40px"/> Welcome @user.main.firstName.getOrElse("")</h2>
  </div>

<div class="g3of4 manager-tab">



<!--
  <div class="teamChangeBox teamPaddedBox">
  <h2 class="teamBoxHeading">Business</h2>
    <div class="teamSettingsCheckbox">
    <h3 class="teamSettingsHeading">Business</h3>
      <a href="#">new business</a>
    <p class="teamSettingsAbout">All newly created Team APIs are set to have Private Documentation and Private Traffic.</p>
  </div>
  </div>
-->
  @if(user.isManager) {
  <div class="teamChangeBox teamPaddedBox">
  <h2 class="teamBoxHeading">Manager board</h2>
    <div class="teamSettingsCheckbox">
    <h3 class="teamSettingsHeading">Services</h3>
    <p class="teamSettingsAbout">List of all services that you providing.</p>
    <div id="actions">
      <!--<a class="btn success" id="add" href="@routes.BusinessServiceController.create()">Add a service</a>-->
        @form(routes.BusinessServiceController.create_new()) {
        <fieldset>



        @inputText(serviceForm("title"), '_label -> "Name", 'class -> "form-control")
        </fieldset>

        <div class="actions">
        <input type="submit" value="Create service" class="btn btn-primary"> 
        </div>
        }
    </div>
    @Option(currentPage.items).filterNot(_.isEmpty).map { entities =>
        <table class="computers zebra-striped">
            <thead>
                <tr>
                    @header(1, "Service")
                    @header(2, "")
                    @header(3, "")
                </tr>
            </thead>
            <tbody>
                @entities.map {
                 case (entity) => {
                        <tr>
                            <td><a href="@routes.BusinessServiceController.update(entity.id.get)">@entity.title</a></td>
                            <td>
                                <a href="@routes.Application.app()#/bprocesses?service=@entity.id">Processes</a>

                            </td>
                            <td>
                              @form(routes.BusinessServiceController.destroy(entity.id.get), 'class -> "topRight") {
                                  <input type="submit" value="Delete service" class="btn danger">
                              }
                            </td>
                        </tr>
                     }
                }
            </tbody>
        </table>
    }
  </div>
  </div>
  }






</div>

<div class="g1of4">

    <h2>Your Credentials:</h2>

    <ul>
        <li>Email: @user.main.userId</li>
        <li>Fist name: @user.main.firstName.getOrElse("")</li>
        <li>Last name: @user.main.lastName.</li>
        <li>Full name: @user.main.fullName.getOrElse("")</li>
        @if(user.isManager) {
        <li>Business: @mngParams.get.business.title </li>
        }
        <!--<li>Logged in from: @user.main.providerId</li>
        <li>Email: @user.main.email.map { email => @email }.getOrElse("Not Available")</li>
        <li>Authentication method: @user.main.authMethod</li>-->
    </ul>

    @user.main.oAuth1Info.map { info =>
        <h2>OAuth1 Info</h2>

        <ul>
            <li>Token: @info.token</li>
            <li>Secret: @info.secret</li>
        </ul>
    }

    @user.main.oAuth2Info.map { info =>
        <h2>OAuth2 Info</h2>

        <ul>
            <li>Access Token: @info.accessToken</li>
            @info.tokenType.map { t => <li>Token Type: @t</li> }
            @info.expiresIn.map { exp => <li>Expires in: @exp seconds</li>}
            @info.refreshToken.map { rt => <li>Refresh Token: @rt</li>}
        </ul>
    }
    <hr>
    <!--
    @user.main.passwordInfo.map { info =>
        <p class="grids flatButtonLine">
          <a class="flatButton" href="@securesocial.controllers.routes.PasswordChange.page.absoluteURL(IdentityProvider.sslEnabled)">Change Password</a>
    </p>
    }-->

<!--
    <span>Link this account to

    @env.providers.values.map { provider =>
        @if( provider.authMethod == OAuth1 || provider.authMethod == OAuth2 ) {
            @defining( "images/providers/%s.png".format(provider.id) ) { imageUrl =>
            <a href="@env.routes.authenticationUrl(provider.id, Some("/link-result"))"> <img src="securesocial.controllers.routes.Assets.at(imageUrl)"/></a>
            }
        }
    }
    </span>-->
       <!-- <a class="btn" href="@securesocial.controllers.routes.LoginPage.logout()">Logout</a> -->
</div>


<div class="g1of4 clearnow">
@if(user.isManager) {
<h2>Your Plan:</h2>

<div class="panel panel-default">
                <div class="panel-body">
                  Trial: 15 Days left
                </div>
                <div class="panel-footer"><a href="plans">Plans</a></div>
              </div>
}

</div>

    
@if(user.isEmployee) {
<div class="g3of4 employee-tab">
  <div class="teamChangeBox teamPaddedBox">
  <h2 class="teamBoxHeading">Employee board</h2>
  <!--
    <div class="teamSettingsCheckbox">
    <h3 class="teamSettingsHeading">Services</h3>
    <a href="#">new services</a>
    <p class="teamSettingsAbout">Desc desc desc</p>
    <div id="actions">
      <a class="btn success" id="add" href="@routes.BusinessServiceController.create()">Add a new services</a>
    </div>
    -->
<div class="perms">
<h3>Permissions:</h3>
<table class="computers zebra-striped">
            <thead>
                <tr>
                    @header(1, "ActPermission")
                    @header(2, "")
                    @header(3, "")
                </tr>
            </thead>
            <tbody>
                @empParams.get.perms.map  {
                 case (entity) => {
                        <tr>
                            <td><a href="#a/bprocess/@entity.bprocess">@entity.id</a></td>
                           
                            <td>
                             @elemOut(entity)
                            </td>
                        </tr>
                     }
                }
            </tbody>
        </table>


</div>
<div class="acts">
<h3>Acts: </h3>
<table class="computers zebra-striped">
            <thead>
                <tr>
                    @header(1, "Process")
                    @header(2, "Element")
                </tr>
            </thead>
            <tbody>
                @empParams.get.res_acts.map { entity =>
                        <tr>
                            <td><a href="#a/bprocess/@entity.bprocess_id">@entity.bprocess_title</a></td>
                            <td>
                         @entity.elem_title
                            </td>
                        </tr>
                     }
            </tbody>
        </table>

</div>


  </div>
</div>
}


</div>





   </div> 
</div>
</div>
</div>

}
